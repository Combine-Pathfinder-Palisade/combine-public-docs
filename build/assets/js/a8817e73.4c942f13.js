"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4931],{4974:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"Combine AWS/deploying-maintaining/full-deploy","title":"Full Deploy Process","description":"When Combine onboards a new customer, these are the steps you need to follow to set up their AWS Account:","source":"@site/docs/Combine AWS/deploying-maintaining/full-deploy.md","sourceDirName":"Combine AWS/deploying-maintaining","slug":"/Combine AWS/deploying-maintaining/full-deploy","permalink":"/Combine AWS/deploying-maintaining/full-deploy","draft":false,"unlisted":false,"editUrl":"https://github.com/Combine-Pathfinder-Palisade/combine-docs/blob/main/docs/Combine AWS/deploying-maintaining/full-deploy.md","tags":[],"version":"current","lastUpdatedBy":"github-actions","lastUpdatedAt":1739223322000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Customer Contacts Spreadsheet","permalink":"/Combine AWS/deploying-maintaining/aws-customer-contacts"},"next":{"title":"Minor Upgrade","permalink":"/Combine AWS/deploying-maintaining/minor-upgrade"}}');var s=o(4848),t=o(8453);const l={},r="Full Deploy Process",c={},a=[{value:"When Combine onboards a new customer, these are the steps you need to follow to set up their AWS Account:",id:"when-combine-onboards-a-new-customer-these-are-the-steps-you-need-to-follow-to-set-up-their-aws-account",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"full-deploy-process",children:"Full Deploy Process"})}),"\n",(0,s.jsx)(n.h2,{id:"when-combine-onboards-a-new-customer-these-are-the-steps-you-need-to-follow-to-set-up-their-aws-account",children:"When Combine onboards a new customer, these are the steps you need to follow to set up their AWS Account:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Email customer the ",(0,s.jsx)(n.code,{children:"combine-provisioning.yaml"})," to run in their account."]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["CloudFormation template is located at ",(0,s.jsx)(n.code,{children:"combine-account-automation/src/main/resources/com/sequoia/combine/templates/provisioning/combine-provisioning.yaml"})]}),"\n",(0,s.jsxs)(n.li,{children:["Customer needs to provide the Provisioning Role ARN found on the ",(0,s.jsx)(n.code,{children:"Outputs"})," tab in CloudFormation after running this yaml (see next step for full details).","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Note: This is often done by Brian, who emails us the Role ARN."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"The customer needs to follow these steps exactly:"}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:['Navigate to "CloudFormation" on AWS (',(0,s.jsx)(n.a,{href:"https://us-east-1.console.aws.amazon.com/cloudformation/",children:"https://us-east-1.console.aws.amazon.com/cloudformation/"}),")"]}),"\n",(0,s.jsx)(n.li,{children:'Find "Stacks" and click "Create Stack" > Select "With new resources"'}),"\n",(0,s.jsx)(n.li,{children:'For "Prerequisite - Prepare template" select "Choose an existing template"'}),"\n",(0,s.jsx)(n.li,{children:'For "Specify Template" select "Upload a template file"'}),"\n",(0,s.jsxs)(n.li,{children:["Choose the ",(0,s.jsx)(n.code,{children:"combine-provisioning.yaml"})," file referenced in the first step"]}),"\n",(0,s.jsxs)(n.li,{children:["For ",(0,s.jsx)(n.code,{children:"Step 2: Specify Stack Details"})," a name must be provided for the stack"]}),"\n",(0,s.jsx)(n.li,{children:'Click "Next"'}),"\n",(0,s.jsx)(n.li,{children:'For "Configure stack options" leave all settings as they are up to "Capabilities"'}),"\n",(0,s.jsx)(n.li,{children:'Under "Capabilities" click the checkbox next to "I acknowledge that AWS CloudFormation might create IAM resources with custom names."'}),"\n",(0,s.jsx)(n.li,{children:'Click "Next"'}),"\n",(0,s.jsx)(n.li,{children:'For "Review and create" leave all settings as they are and click "Submit"'}),"\n",(0,s.jsxs)(n.li,{children:["The browser should proceed to a menu under ",(0,s.jsx)(n.code,{children:"Cloudformation > Stacks > /<StackName/>"})]}),"\n",(0,s.jsx)(n.li,{children:'The tab "Events - updated" will be selected'}),"\n",(0,s.jsxs)(n.li,{children:["The current status should show as ",(0,s.jsx)(n.code,{children:"CREATE_IN_PROGRESS"})]}),"\n",(0,s.jsxs)(n.li,{children:["After a couple minutes a number of events will be logged and the status should change to ",(0,s.jsx)(n.code,{children:"CREATE_COMPLETE"})]}),"\n",(0,s.jsxs)(n.li,{children:["When provisioning is complete the customer needs to find the ",(0,s.jsx)(n.code,{children:"Outputs"})," tab on the same page and provide us with the ",(0,s.jsx)(n.code,{children:"Provisioning Role ARN"})," value"]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Pull the latest tag for the ",(0,s.jsx)(n.code,{children:"combine-aws"})," repository. (e.g., ",(0,s.jsx)(n.code,{children:"git tag -l"})," then ",(0,s.jsx)(n.code,{children:"git checkout <latest_tag>"}),")"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Create a ",(0,s.jsx)(n.code,{children:"clients.json"})," (located at ",(0,s.jsx)(n.code,{children:"combine-account-automation/clients.json"}),") entry for the customer using the AWS Account Number and Role ARN they provided in Step"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Here is an example json entry for addition to clients.json:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'  "customer": {\n     "region": "us-east-1",\n     "masterRegion": "us-east-1",\n     "shardId": "",\n     "clientAccountId": "<Customer Account Number>",\n     "clientRoleArn": "arn:aws:iam::<Customer Account Number>:role/Combine-Provisioning-Role",\n     "bucketEncryptionKey": "",\n     "hasUserManagementAccount": "false",\n     "followerType": "None",\n     "buildTS": "true",\n     "buildS": "true",\n     "buildGovCloud": "false",\n     "certificateName": "Customer",\n     "templateParameters": {\n       "combine.yaml": {\n       },\n       "combine-policy.yaml": {\n       },\n       "combine-vpc.yaml": {\n       }\n     }\n   }\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Note: You will need to add this change to the ",(0,s.jsx)(n.code,{children:"master"})," branch since you are working in a tag."]}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Build and deploy the Combine components:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["for versions 3.13 and later:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Perform a ",(0,s.jsx)(n.code,{children:"mvn clean package install"})," in root directory of the ",(0,s.jsx)(n.code,{children:"combine-aws"})," repository. This will build all Combine components and package them as needed."]}),"\n",(0,s.jsxs)(n.li,{children:["Perform the actual deploy:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["On Mac/Linux: ",(0,s.jsx)(n.code,{children:'java -classpath "combine-account-automation/lib/*:combine-account-automation/target/*" com.sequoia.combine.accounts.CombineCommandExecutor full --config-store-profile <customer name from clients.json> --bricks-release-version <version number>'})," (Bricks Version numbers use the format: ",(0,s.jsx)(n.code,{children:"bricks_v_<major>_<minor>"}),".)"]}),"\n",(0,s.jsxs)(n.li,{children:["On Windows: ",(0,s.jsx)(n.code,{children:"java -classpath lib/*;target/* com.sequoia.combine.accounts.CombineCommandExecutor full --config-store-profile <customer name from clients.json> --bricks-release-version <version number>"})," (Bricks Version numbers use the format: ",(0,s.jsx)(n.code,{children:"bricks_v_<major>_<minor>"}),".)"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["for versions prior to 3.13:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Perform a ",(0,s.jsx)(n.code,{children:"npm i && npm run build"})," in the ",(0,s.jsx)(n.code,{children:"combine-tap/tap-dashboard"})," directory."]}),"\n",(0,s.jsxs)(n.li,{children:["Perform a ",(0,s.jsx)(n.code,{children:"mvn clean install"})," on the following directories:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"combine-commons"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"combine-tap/tap-api"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"combine-endpoints"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Perform a ",(0,s.jsx)(n.code,{children:"mvn clean package install"})," on ",(0,s.jsx)(n.code,{children:"combine-account-automation"})]}),"\n",(0,s.jsxs)(n.li,{children:["Run the following command:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:'mvn exec:java -q "-Dexec.args=full --config-store-profile {CUSTOMER_NAME_FROM_CLIENTS.JSON} --bricks-release-version bricks_v_3_12"'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"If the tool runs with no errors, you should be able to log into their AWS account and see Combine resources being created."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["After the tool completes navigate to the TAP Dashboard using the admin certificates downloaded from the link provided (or you can retrieve the ",(0,s.jsx)(n.code,{children:"admin.zip"})," from the ",(0,s.jsx)(n.code,{children:"combine-app-storage-<account number>-public"})," bucket) and add any additional users the customer requires. Once they receive their credentials, they often need help authenticating - this often happens live during the onboarding session."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Update our customer list: ",(0,s.jsx)(n.a,{href:"https://sequoiaholdingsllc-my.sharepoint.com/:x:/g/personal/bking_sequoiainc_com/EfVi7XircpJIsS2v8HHknPcBuRV2Lh3efr3AHteAP_VEcA?e=WfGGpt",children:"Customer Accounts Spreadsheet"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["You also need to add an entry for the customer in the ",(0,s.jsx)(n.code,{children:"combine-aws-customers/customers"})," repo. This includes the certs, ",(0,s.jsx)(n.code,{children:"passwords.txt"})," file, ",(0,s.jsx)(n.code,{children:"tap.txt"})," file, ",(0,s.jsx)(n.code,{children:"README.txt"}),", etc."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"tap.txt"})," should contain the url of the Load Balancer that points to the customer's TAP Autoscaling group."]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>l,x:()=>r});var i=o(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);